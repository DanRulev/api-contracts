syntax = "proto3";

package danRulev.task_grpc;

option go_package = "github.com/DanRulev/api-contracts/gen/go/task;taskgrpc";

import "google/protobuf/empty.proto";

service TaskService{
    rpc CreateTask(CreateTaskRequest) returns (CreateTaskResponse);
    rpc Task(TaskRequest) returns (TaskResponse);
    rpc Tasks(TasksRequest) returns (TasksResponse);
    rpc UpdateTask(UpdateTaskRequest) returns (TaskResponse);
    rpc DeleteTask(TaskRequest) returns (google.protobuf.Empty);
    rpc Stats(TasksStatsRequest) returns (TasksStatsResponse);
}

message CreateTaskRequest{ 
    string user_id = 1;
    CreateTaskParams task = 2;
}

message CreateTaskParams{ 
    string title = 1;
    string description = 2;
    string priority = 3;
    bool private = 4;
    string deadline = 5;
    string group_id = 6;
    string assigned_to = 7;
}

message CreateTaskResponse{ 
    string id = 1;
}

message TaskRequest{ 
    string task_id = 1;
    string user_id = 2;
}

message TaskResponse{ 
    string id = 1;
    string group_id = 2;
    string assigned_by = 3;
    string assigned_to = 4;
    string title = 5;
    string description = 6;
    string status = 7;
    string priority = 8;
    bool private = 9;
    string deadline = 10;
    string created_at = 11;
    string updated_at = 12;
}

message TasksRequest{
    string user_id = 1;
    optional string group_id = 2;
    TasksFilterParams filter = 3;
}

message TasksFilterParams{
    string sort = 1;
    string order = 2;
    int64 limit = 3;
    int64 offset = 4;
    optional string deadline_before = 5;
    optional string deadline_after = 6;
    optional string status = 7;
    optional string priority = 8;
    optional string assigned_by = 9;
    optional string assigned_to = 10;
}

message TasksResponse{ 
    repeated ShortTaskResponse tasks = 1;
    PaginationResponse pagination = 2;
}  

message ShortTaskResponse{ 
    string id = 1;
    string group_id = 2;
    string title = 3;
    string status = 4;
    string priority = 5;
    bool private = 6;
    string deadline = 7;
}

message PaginationResponse{ 
    int64 total = 1;
    int64 page = 2;
    int64 limit = 3;
    int64 total_pages = 4;
}

message UpdateTaskRequest{ 
    string task_id = 1;
    string user_id = 2;
    UpdateTaskParams task = 3;
}

message UpdateTaskParams{ 
    optional string title = 1;
    optional string description = 2;
    optional string status = 3;
    optional string priority = 4;
    optional bool private = 5;
    optional string deadline = 6;
}

message TasksStatsRequest{
    string user_id = 1;
    optional string group_id = 2;
    TasksStatsParams params = 3;
}

message TasksStatsParams{
    optional string priority = 1;
    optional string start_period = 2;
    optional string end_period = 3;
}

message TasksStatsResponse{ 
    int64 total = 1;
    int64 completed = 2;
    int64 in_progress = 3;
    int64 pending = 4;
    int64 cancelled = 5;
    int64 overdue = 6;
    float completion_rate = 7;
}
